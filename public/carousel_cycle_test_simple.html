<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>轮播图循环逻辑简化测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-container {
            text-align: center;
            margin: 30px 0;
        }
        .slides {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        .slide {
            width: 100px;
            height: 100px;
            background-color: #e0e0e0;
            border: 2px solid #ccc;
            border-radius: 4px;
            margin: 0 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .slide.active {
            background-color: #3498db;
            color: white;
            border-color: #2980b9;
            transform: scale(1.1);
        }
        .controls {
            margin: 20px 0;
        }
        .btn {
            padding: 10px 20px;
            margin: 0 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        .btn-primary:hover {
            background-color: #2980b9;
        }
        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }
        .btn-danger:hover {
            background-color: #c0392b;
        }
        .log-container {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 4px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            margin-top: 20px;
            text-align: left;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px 0;
            border-bottom: 1px solid #34495e;
        }
        .log-entry:last-child {
            border-bottom: none;
        }
        .log-time {
            color: #95a5a6;
            margin-right: 10px;
        }
        .log-info {
            color: #ecf0f1;
        }
        .log-success {
            color: #2ecc71;
        }
        .log-error {
            color: #e74c3c;
        }
        .status-box {
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            text-align: left;
        }
        .status-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .test-step {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            background-color: #f8f9fa;
            text-align: left;
        }
        .test-step.passed {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
        }
        .test-step.failed {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>轮播图循环逻辑简化测试</h1>
        
        <div class="status-box status-info">
            <p>此页面简化测试轮播图的循环逻辑，特别验证：</p>
            <ul>
                <li>第三张图片显示后，是否能正确回到第一张图片</li>
                <li>核心循环逻辑: (currentIndex + 1) % slides.length 是否正常工作</li>
            </ul>
        </div>
        
        <div class="test-container">
            <h2>轮播图模拟</h2>
            <div class="slides">
                <div class="slide active" id="slide1">1</div>
                <div class="slide" id="slide2">2</div>
                <div class="slide" id="slide3">3</div>
            </div>
            
            <div class="controls">
                <button id="startBtn" class="btn btn-primary">开始测试</button>
                <button id="stopBtn" class="btn btn-danger">停止测试</button>
                <button id="resetBtn" class="btn btn-primary">重置测试</button>
            </div>
        </div>
        
        <h2>测试步骤</h2>
        <div class="test-steps">
            <div class="test-step" id="step1">
                <strong>步骤 1:</strong> 初始显示第一张图片
            </div>
            <div class="test-step" id="step2">
                <strong>步骤 2:</strong> 5秒后切换到第二张图片
            </div>
            <div class="test-step" id="step3">
                <strong>步骤 3:</strong> 再经过5秒后切换到第三张图片
            </div>
            <div class="test-step" id="step4">
                <strong>步骤 4 (关键):</strong> 再经过5秒后，应该从第三张图片正确切换回第一张图片
            </div>
        </div>
        
        <h2>核心循环代码</h2>
        <div class="log-container">
            <div class="log-entry">
                <span class="log-info">// 轮播图核心循环逻辑</span>
            </div>
            <div class="log-entry">
                <span class="log-info">function nextSlide() {</span>
            </div>
            <div class="log-entry">
                <span class="log-info">  console.log(`当前索引: ${'${currentIndex}'}, 幻灯片数量: ${'${slides.length}'}`);</span>
            </div>
            <div class="log-entry">
                <span class="log-info">  const nextIndex = (currentIndex + 1) % slides.length;</span>
            </div>
            <div class="log-entry">
                <span class="log-info">  console.log(`计算下一张索引: (${'${currentIndex}'} + 1) % ${'${slides.length}'} = ${'${nextIndex}'}`);</span>
            </div>
            <div class="log-entry">
                <span class="log-info">  currentIndex = nextIndex;</span>
            </div>
            <div class="log-entry">
                <span class="log-info">  showSlide(currentIndex);</span>
            </div>
            <div class="log-entry">
                <span class="log-info">}</span>
            </div>
        </div>
        
        <h2>测试日志</h2>
        <div class="log-container" id="logContainer">
            <div class="log-entry">
                <span class="log-time">[${new Date().toLocaleTimeString()}]</span>
                <span class="log-info">测试页面已加载</span>
            </div>
        </div>
        
        <h2>测试结果</h2>
        <div id="testResult" class="status-box status-info">
            <p>测试尚未开始。点击"开始测试"按钮启动轮播图循环测试。</p>
        </div>
    </div>

    <script>
        // 获取DOM元素
        const slides = document.querySelectorAll('.slide');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const resetBtn = document.getElementById('resetBtn');
        const logContainer = document.getElementById('logContainer');
        const testResult = document.getElementById('testResult');
        const step1 = document.getElementById('step1');
        const step2 = document.getElementById('step2');
        const step3 = document.getElementById('step3');
        const step4 = document.getElementById('step4');
        
        // 初始化变量
        let currentIndex = 0;
        let intervalId = null;
        let isTestPassed = false;
        let isTestRunning = false;
        
        // 添加日志
        function log(message, type = 'info') {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            
            logEntry.innerHTML = `
                <span class="log-time">[${timeString}]</span>
                <span class="log-${type}">${message}</span>
            `;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        // 显示指定幻灯片
        function showSlide(index) {
            // 移除所有幻灯片的active类
            slides.forEach(slide => slide.classList.remove('active'));
            
            // 为当前幻灯片添加active类
            slides[index].classList.add('active');
            
            // 记录日志
            log(`显示幻灯片 ${index + 1}`);
            
            // 检查是否完成测试步骤
            if (index === 0 && isTestRunning) {
                step1.className = 'test-step passed';
                step1.innerHTML = '<strong>步骤 1:</strong> 初始显示第一张图片 <strong>✓ 通过</strong>';
            } else if (index === 1 && isTestRunning) {
                step2.className = 'test-step passed';
                step2.innerHTML = '<strong>步骤 2:</strong> 5秒后切换到第二张图片 <strong>✓ 通过</strong>';
            } else if (index === 2 && isTestRunning) {
                step3.className = 'test-step passed';
                step3.innerHTML = '<strong>步骤 3:</strong> 再经过5秒后切换到第三张图片 <strong>✓ 通过</strong>';
                log(`重要: 已到达最后一张图片，5秒后应该回到第一张图片`);
            } else if (index === 0 && isTestRunning && currentIndex !== 0) {
                // 从第三张回到第一张，完成循环
                step4.className = 'test-step passed';
                step4.innerHTML = '<strong>步骤 4 (关键):</strong> 再经过5秒后，从第三张图片正确切换回第一张图片 <strong>✓ 通过</strong>';
                log(`成功: 轮播图从第三张正确回到了第一张图片！测试通过！`, 'success');
                
                // 更新测试结果
                testResult.className = 'status-box status-success';
                testResult.innerHTML = '<p>测试成功: 轮播图能够正确地从第三张图片回到第一张图片！</p>';
                isTestPassed = true;
                
                // 停止测试
                stopTest();
            }
        }
        
        // 下一张幻灯片
        function nextSlide() {
            console.log(`当前索引: ${currentIndex}, 幻灯片数量: ${slides.length}`);
            const nextIndex = (currentIndex + 1) % slides.length;
            console.log(`计算下一张索引: (${currentIndex} + 1) % ${slides.length} = ${nextIndex}`);
            
            // 特别检查从最后一张到第一张的循环
            if (currentIndex === slides.length - 1) {
                console.log(`检测到循环点: 从第${slides.length}张到第1张`);
                log(`检测到循环点: 从第${slides.length}张到第1张`);
            }
            
            currentIndex = nextIndex;
            showSlide(currentIndex);
        }
        
        // 开始测试
        function startTest() {
            if (intervalId) {
                clearInterval(intervalId);
            }
            
            isTestRunning = true;
            log('开始轮播图循环测试，每5秒切换一次...');
            
            // 显示第一张幻灯片
            showSlide(0);
            
            // 设置5秒轮播间隔
            intervalId = setInterval(nextSlide, 5000);
            
            // 更新按钮状态
            startBtn.disabled = true;
            startBtn.style.opacity = '0.5';
            stopBtn.disabled = false;
            stopBtn.style.opacity = '1';
        }
        
        // 停止测试
        function stopTest() {
            if (intervalId) {
                clearInterval(intervalId);
                intervalId = null;
                log('停止轮播图循环测试');
            }
            
            isTestRunning = false;
            
            // 更新按钮状态
            startBtn.disabled = false;
            startBtn.style.opacity = '1';
            stopBtn.disabled = true;
            stopBtn.style.opacity = '0.5';
        }
        
        // 重置测试
        function resetTest() {
            stopTest();
            
            // 重置索引
            currentIndex = 0;
            
            // 重置测试步骤
            step1.className = 'test-step';
            step1.innerHTML = '<strong>步骤 1:</strong> 初始显示第一张图片';
            step2.className = 'test-step';
            step2.innerHTML = '<strong>步骤 2:</strong> 5秒后切换到第二张图片';
            step3.className = 'test-step';
            step3.innerHTML = '<strong>步骤 3:</strong> 再经过5秒后切换到第三张图片';
            step4.className = 'test-step';
            step4.innerHTML = '<strong>步骤 4 (关键):</strong> 再经过5秒后，应该从第三张图片正确切换回第一张图片';
            
            // 重置测试结果
            testResult.className = 'status-box status-info';
            testResult.innerHTML = '<p>测试已重置。点击"开始测试"按钮重新启动轮播图循环测试。</p>';
            
            // 重置轮播图
            showSlide(0);
            
            log('重置轮播图循环测试');
        }
        
        // 绑定事件
        startBtn.addEventListener('click', startTest);
        stopBtn.addEventListener('click', stopTest);
        resetBtn.addEventListener('click', resetTest);
        
        // 初始化
        log('点击"开始测试"按钮启动轮播图循环测试');
        stopBtn.disabled = true;
        stopBtn.style.opacity = '0.5';
        
        // 测试核心循环逻辑
        function testCycleLogic() {
            // 模拟三次循环
            const testCases = [
                { currentIndex: 0, slidesLength: 3, expected: 1 },
                { currentIndex: 1, slidesLength: 3, expected: 2 },
                { currentIndex: 2, slidesLength: 3, expected: 0 }, // 关键测试：第三张回到第一张
                { currentIndex: 0, slidesLength: 3, expected: 1 },
                { currentIndex: 1, slidesLength: 3, expected: 2 },
                { currentIndex: 2, slidesLength: 3, expected: 0 }  // 再次测试循环
            ];
            
            let allPassed = true;
            log('开始预测试核心循环逻辑...');
            
            testCases.forEach((testCase, index) => {
                const result = (testCase.currentIndex + 1) % testCase.slidesLength;
                const passed = result === testCase.expected;
                
                log(`测试 ${index + 1}: (${testCase.currentIndex} + 1) % ${testCase.slidesLength} = ${result}, 期望: ${testCase.expected} ${passed ? '(通过)' : '(失败)'}`, 
                    passed ? 'success' : 'error');
                
                if (!passed) {
                    allPassed = false;
                }
            });
            
            if (allPassed) {
                log('预测试成功: 核心循环逻辑正常工作！', 'success');
            } else {
                log('预测试失败: 核心循环逻辑存在问题！', 'error');
            }
        }
        
        // 运行预测试
        testCycleLogic();
    </script>
</body>
</html>