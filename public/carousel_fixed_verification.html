<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>轮播图修复验证</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .carousel-container {
            position: relative;
            width: 100%;
            height: 400px;
            margin: 30px 0;
            border: 2px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
        }
        .carousel-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            z-index: 1;
            transition: opacity 0.5s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .carousel-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .carousel-slide.active {
            opacity: 1;
            z-index: 2;
        }
        .carousel-indicators {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            text-align: center;
            z-index: 3;
        }
        .carousel-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #ccc;
            margin: 0 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .carousel-indicator.active {
            background-color: #333;
        }
        .log-container {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 4px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            margin-top: 20px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px 0;
            border-bottom: 1px solid #34495e;
        }
        .log-entry:last-child {
            border-bottom: none;
        }
        .log-time {
            color: #95a5a6;
            margin-right: 10px;
        }
        .log-info {
            color: #ecf0f1;
        }
        .log-success {
            color: #2ecc71;
        }
        .log-error {
            color: #e74c3c;
        }
        .status-box {
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .status-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .controls {
            margin: 20px 0;
            text-align: center;
        }
        .btn {
            padding: 10px 20px;
            margin: 0 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        .btn-primary:hover {
            background-color: #2980b9;
        }
        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }
        .btn-danger:hover {
            background-color: #c0392b;
        }
        .code-section {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            border-left: 4px solid #3498db;
            margin: 15px 0;
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .debug-info {
            margin: 20px 0;
            padding: 15px;
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
        }
        .debug-item {
            margin: 5px 0;
        }
        .debug-label {
            font-weight: bold;
            color: #856404;
        }
        .carousel-placeholder {
            width: 100%;
            height: 100%;
            background-color: #f5f5f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #666;
            position: absolute;
            top: 0;
            left: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>轮播图修复验证</h1>
        
        <div class="status-box status-info">
            <p>此页面用于验证轮播图修复后的功能，特别关注：</p>
            <ul>
                <li>轮播图是否能正确地从第三张图片回到第一张图片</li>
                <li>循环逻辑是否按照修复后的代码正确执行</li>
            </ul>
        </div>
        
        <h2>修复内容</h2>
        <div class="code-section">
// 修复后的轮播图循环逻辑
function startCarousel() {
  // 自动轮播
  let intervalId = setInterval(() => {
    console.log(`当前索引: ${currentIndex}, 幻灯片数量: ${slides.length}`);
    // 直接计算下一个索引，确保循环逻辑正确
    let nextIndex = (currentIndex + 1) % slides.length;
    console.log(`计算下一张索引: (${currentIndex} + 1) % ${slides.length} = ${nextIndex}`);
    
    // 特别检查从最后一张到第一张的循环
    if (currentIndex === slides.length - 1) {
      console.log(`检测到循环点: 从第${slides.length}张到第1张`);
      // 确保从最后一张回到第一张
      nextIndex = 0;
    }
    
    currentIndex = nextIndex;
    showSlide(currentIndex);
  }, 5000);
}
        </div>
        
        <h2>轮播图演示</h2>
        <div class="carousel-container" id="carouselContainer">
            <div class="carousel-slide active">
                <div class="carousel-placeholder">
                    <h2>图片 1</h2>
                    <p>轮播图第一张</p>
                </div>
            </div>
            <div class="carousel-slide">
                <div class="carousel-placeholder">
                    <h2>图片 2</h2>
                    <p>轮播图第二张</p>
                </div>
            </div>
            <div class="carousel-slide">
                <div class="carousel-placeholder">
                    <h2>图片 3</h2>
                    <p>轮播图第三张</p>
                </div>
            </div>
            <div class="carousel-indicators">
                <span class="carousel-indicator active"></span>
                <span class="carousel-indicator"></span>
                <span class="carousel-indicator"></span>
            </div>
        </div>
        
        <div class="controls">
            <button id="startBtn" class="btn btn-primary">开始轮播</button>
            <button id="stopBtn" class="btn btn-danger">停止轮播</button>
            <button id="resetBtn" class="btn btn-primary">重置轮播</button>
        </div>
        
        <div class="debug-info">
            <div class="debug-item">
                <span class="debug-label">当前索引: </span>
                <span id="currentIndex">0</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">幻灯片数量: </span>
                <span id="slidesCount">3</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">轮播状态: </span>
                <span id="carouselStatus">未启动</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">已完成循环次数: </span>
                <span id="cycleCount">0</span>
            </div>
        </div>
        
        <h2>轮播图验证步骤</h2>
        <ol>
            <li>初始状态显示第一张图片</li>
            <li>5秒后自动切换到第二张图片</li>
            <li>再经过5秒后自动切换到第三张图片</li>
            <li>再经过5秒后，应该从第三张图片正确回到第一张图片（关键验证点）</li>
            <li>继续循环切换</li>
        </ol>
        
        <h2>调试日志</h2>
        <div class="log-container" id="logContainer">
            <div class="log-entry">
                <span class="log-time">[${new Date().toLocaleTimeString()}]</span>
                <span class="log-info">页面加载完成，等待开始轮播...</span>
            </div>
        </div>
        
        <h2>验证结果</h2>
        <div id="verificationResult" class="status-box status-info">
            <p>验证尚未开始。点击"开始轮播"按钮启动轮播图并观察从第三张图片到第一张图片的切换。</p>
        </div>
    </div>

    <script>
        // 获取DOM元素
        const container = document.getElementById('carouselContainer');
        const slides = document.querySelectorAll('.carousel-slide');
        const indicators = document.querySelectorAll('.carousel-indicator');
        const logContainer = document.getElementById('logContainer');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const resetBtn = document.getElementById('resetBtn');
        const currentIndexElement = document.getElementById('currentIndex');
        const slidesCountElement = document.getElementById('slidesCount');
        const carouselStatusElement = document.getElementById('carouselStatus');
        const cycleCountElement = document.getElementById('cycleCount');
        const verificationResultElement = document.getElementById('verificationResult');
        
        // 初始化变量
        let currentIndex = 0;
        let intervalId = null;
        let cycleCount = 0;
        let verificationPassed = false;
        
        // 设置幻灯片样式
        slides.forEach((slide, index) => {
            slide.style.position = 'absolute';
            slide.style.top = '0';
            slide.style.left = '0';
            slide.style.width = '100%';
            slide.style.height = '100%';
            slide.style.opacity = index === 0 ? '1' : '0';
            slide.style.zIndex = index === 0 ? '2' : '1';
            slide.style.transition = 'opacity 0.5s ease-in-out';
            slide.style.display = 'block';
        });
        
        // 更新指示器样式
        indicators.forEach((indicator, index) => {
            indicator.style.width = '12px';
            indicator.style.height = '12px';
            indicator.style.borderRadius = '50%';
            indicator.style.cursor = 'pointer';
            indicator.style.margin = '0 5px';
            indicator.style.backgroundColor = index === 0 ? '#333' : '#ccc';
            indicator.style.display = 'inline-block';
            indicator.style.border = 'none';
            indicator.style.padding = '0';
        });
        
        // 显示指定幻灯片
        function showSlide(index) {
            log(`切换到幻灯片 ${index + 1}`);
            
            // 隐藏所有幻灯片
            slides.forEach((slide, i) => {
                slide.classList.toggle('active', i === index);
                slide.style.opacity = i === index ? '1' : '0';
                slide.style.zIndex = i === index ? '2' : '1';
            });
            
            // 更新指示器
            indicators.forEach((indicator, i) => {
                if (i === index) {
                    indicator.classList.add('active');
                    indicator.style.backgroundColor = '#333';
                } else {
                    indicator.classList.remove('active');
                    indicator.style.backgroundColor = '#ccc';
                }
            });
            
            // 更新当前索引显示
            currentIndex = index;
            currentIndexElement.textContent = currentIndex;
            
            // 检查是否完成循环
            if (index === 0 && cycleCount > 0) {
                log(`成功: 轮播图从第三张正确回到了第一张图片！`, 'success');
                verificationPassed = true;
                updateVerificationResult();
            }
            
            // 增加循环计数
            if (index === 2) {
                log(`重要: 已到达第三张图片，5秒后应该回到第一张图片`);
            }
        }
        
        // 开始自动轮播
        function startCarousel() {
            if (intervalId) {
                clearInterval(intervalId);
            }
            
            log('开始轮播图（5秒间隔）');
            carouselStatusElement.textContent = '运行中';
            
            // 自动轮播 - 使用修复后的循环逻辑
            intervalId = setInterval(() => {
                console.log(`当前索引: ${currentIndex}, 幻灯片数量: ${slides.length}`);
                // 直接计算下一个索引，确保循环逻辑正确
                let nextIndex = (currentIndex + 1) % slides.length;
                console.log(`计算下一张索引: (${currentIndex} + 1) % ${slides.length} = ${nextIndex}`);
                
                // 特别检查从最后一张到第一张的循环
                if (currentIndex === slides.length - 1) {
                    console.log(`检测到循环点: 从第${slides.length}张到第1张`);
                    log(`检测到循环点: 从第${slides.length}张到第1张`);
                    // 确保从最后一张回到第一张
                    nextIndex = 0;
                    // 增加循环计数
                    cycleCount++;
                    cycleCountElement.textContent = cycleCount;
                }
                
                currentIndex = nextIndex;
                showSlide(currentIndex);
            }, 5000);
        }
        
        // 停止轮播
        function stopCarousel() {
            if (intervalId) {
                clearInterval(intervalId);
                intervalId = null;
                log('停止轮播图');
                carouselStatusElement.textContent = '已停止';
            }
        }
        
        // 重置轮播
        function resetCarousel() {
            stopCarousel();
            currentIndex = 0;
            cycleCount = 0;
            verificationPassed = false;
            
            // 更新显示
            currentIndexElement.textContent = currentIndex;
            cycleCountElement.textContent = cycleCount;
            showSlide(currentIndex);
            
            // 重置验证结果
            verificationResultElement.className = 'status-box status-info';
            verificationResultElement.innerHTML = '<p>轮播已重置。点击"开始轮播"按钮重新开始验证。</p>';
            
            log('重置轮播图');
        }
        
        // 添加日志
        function log(message, type = 'info') {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            
            logEntry.innerHTML = `
                <span class="log-time">[${timeString}]</span>
                <span class="log-${type}">${message}</span>
            `;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        // 更新验证结果
        function updateVerificationResult() {
            if (verificationPassed) {
                verificationResultElement.className = 'status-box status-success';
                verificationResultElement.innerHTML = '<p>验证成功: 轮播图能够正确地从第三张图片回到第一张图片！</p>';
                log('验证完成 - 轮播图循环功能正常工作！', 'success');
            } else {
                verificationResultElement.className = 'status-box status-info';
                verificationResultElement.innerHTML = '<p>验证进行中... 请等待轮播图从第三张图片切换到第一张图片。</p>';
            }
        }
        
        // 绑定事件
        startBtn.addEventListener('click', startCarousel);
        stopBtn.addEventListener('click', stopCarousel);
        resetBtn.addEventListener('click', resetCarousel);
        
        // 为指示器添加点击事件
        indicators.forEach((indicator, index) => {
            indicator.addEventListener('click', () => {
                log(`点击指示器 ${index + 1}`);
                currentIndex = index;
                showSlide(currentIndex);
                
                // 重置自动轮播计时器
                if (intervalId) {
                    clearInterval(intervalId);
                    intervalId = setInterval(() => {
                        console.log(`当前索引: ${currentIndex}, 幻灯片数量: ${slides.length}`);
                        // 直接计算下一个索引，确保循环逻辑正确
                        let nextIndex = (currentIndex + 1) % slides.length;
                        console.log(`计算下一张索引: (${currentIndex} + 1) % ${slides.length} = ${nextIndex}`);
                        
                        // 特别检查从最后一张到第一张的循环
                        if (currentIndex === slides.length - 1) {
                            console.log(`检测到循环点: 从第${slides.length}张到第1张`);
                            log(`检测到循环点: 从第${slides.length}张到第1张`);
                            // 确保从最后一张回到第一张
                            nextIndex = 0;
                            // 增加循环计数
                            cycleCount++;
                            cycleCountElement.textContent = cycleCount;
                        }
                        
                        currentIndex = nextIndex;
                        showSlide(currentIndex);
                    }, 5000);
                }
            });
        });
        
        // 初始化
        slidesCountElement.textContent = slides.length;
        log('点击"开始轮播"按钮启动轮播图验证');
        log('特别关注：第三张图片5秒后是否能正确回到第一张图片');
    </script>
</body>
</html>