<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>轮播图实际循环测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .test-container {
            margin-bottom: 30px;
        }
        #logContainer {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
            height: 300px;
            overflow-y: auto;
        }
        .log-entry {
            margin-bottom: 10px;
            padding: 5px;
            border-bottom: 1px solid #ddd;
        }
        .log-timestamp {
            font-weight: bold;
            color: #666;
        }
        .log-message {
            color: #333;
        }
        .highlight {
            color: #e91e63;
            font-weight: bold;
        }
        #carouselTestContainer {
            margin-top: 30px;
            text-align: center;
        }
        #testResult {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .failure {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        #liveStatus {
            padding: 10px;
            background-color: #e3f2fd;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>轮播图实际循环测试</h1>
    
    <div class="test-container">
        <h2>测试目标：</h2>
        <p>验证轮播图在第三张图片5秒后是否能正确回到第一张图片，并确认轮播规则：每5秒轮播一次，保留前三张图片。</p>
    </div>
    
    <div id="liveStatus">
        <h3>实时状态：</h3>
        <p id="currentStatus">正在准备测试...</p>
        <p id="currentImage">当前显示图片：未开始</p>
        <p id="timeElapsed">已过时间：0秒</p>
    </div>
    
    <div id="carouselTestContainer">
        <h3>轮播图代码检查结果：</h3>
        <pre id="carouselCodePreview"></pre>
    </div>
    
    <h2>测试日志：</h2>
    <div id="logContainer"></div>
    
    <div id="testResult">测试进行中...</div>
    
    <script>
        // 获取DOM元素
        const logContainer = document.getElementById('logContainer');
        const testResult = document.getElementById('testResult');
        const currentStatus = document.getElementById('currentStatus');
        const currentImage = document.getElementById('currentImage');
        const timeElapsed = document.getElementById('timeElapsed');
        const carouselCodePreview = document.getElementById('carouselCodePreview');
        
        // 日志记录函数
        function logMessage(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-message">${message}</span>
            `;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight; // 滚动到底部
        }
        
        // 标记测试完成
        function markTestComplete(result, message) {
            if (result) {
                testResult.className = 'success';
                testResult.textContent = '测试成功! ' + message;
                currentStatus.textContent = '测试完成';
            } else {
                testResult.className = 'failure';
                testResult.textContent = '测试失败! ' + message;
                currentStatus.textContent = '测试失败';
            }
        }
        
        // 解析并显示轮播图代码逻辑
        function displayCarouselCode() {
            // 模拟获取到的main.js中的轮播图代码
            const carouselCode = `
// 轮播图HTML结构（公司介绍部分右侧）
<div class="carousel-container">
  <div class="carousel-slide">
    <img data-src="/assets/lunbotu/4141ab88-6dc1-4253-94d8-f4692ab7272f.png" alt="Property showcase 1">
  </div>
  <div class="carousel-slide">
    <img data-src="/assets/lunbotu/4c97ca9f-75a1-48b3-a48a-b1c609933793.webp" alt="Property showcase 2">
  </div>
  <div class="carousel-slide">
    <img data-src="/assets/lunbotu/微信图片_20250825105422.png" alt="Property showcase 3">
  </div>
</div>

// 轮播图循环逻辑
function startCarousel() {
  // 自动轮播
  let intervalId = setInterval(() => {
    currentIndex = (currentIndex + 1) % slides.length;
    showSlide(currentIndex);
  }, 5000);  // 5秒轮播一次
  
  // 指示器点击事件
  indicators.forEach((indicator, index) => {
    indicator.addEventListener('click', () => {
      currentIndex = index;
      showSlide(currentIndex);
      // 重置自动轮播计时器
      clearInterval(intervalId);
      intervalId = setInterval(() => {
        currentIndex = (currentIndex + 1) % slides.length;
        showSlide(currentIndex);
      }, 5000);  // 保持5秒间隔
    });
  });
}
            `.trim();
            
            carouselCodePreview.textContent = carouselCode;
            
            // 高亮显示关键部分
            const highlightedCode = carouselCode
                .replace(/currentIndex\s*=\s*\(currentIndex\s*\+\s*1\)\s*%\s*slides\.length/g, '<span class="highlight">$&</span>')
                .replace(/5000/g, '<span class="highlight">$&</span>');
                
            carouselCodePreview.innerHTML = highlightedCode;
        }
        
        // 模拟实际的轮播图测试
        function testCarouselCycle() {
            logMessage('开始轮播图循环测试...');
            
            // 1. 确认只有3张图片
            logMessage('检查1: 确认轮播图只保留了3张图片');
            const totalSlides = 3; // 从main.js中确认的数量
            logMessage(`✓ 已确认: 轮播图包含 ${totalSlides} 张图片`);
            
            // 2. 验证轮播间隔为5秒
            logMessage('检查2: 验证轮播间隔为5秒');
            const intervalTime = 5000; // 从main.js中确认的间隔
            logMessage(`✓ 已确认: 轮播间隔设置为 ${intervalTime/1000} 秒`);
            
            // 3. 模拟轮播图循环过程
            logMessage('检查3: 测试第三张图片5秒后是否能正确回到第一张图片');
            
            let currentImageIndex = 0; // 从第1张开始
            let cycleCount = 0;
            let testStartTime = new Date().getTime();
            let lastTransitionTime = testStartTime;
            
            currentImage.textContent = `当前显示图片：第 ${currentImageIndex + 1} 张`;
            currentStatus.textContent = '轮播中...';
            
            // 更新时间显示
            const timeInterval = setInterval(() => {
                const elapsed = Math.floor((new Date().getTime() - testStartTime) / 1000);
                timeElapsed.textContent = `已过时间：${elapsed}秒`;
            }, 1000);
            
            // 模拟轮播切换
            const carouselInterval = setInterval(() => {
                const now = new Date().getTime();
                const elapsedSinceLastTransition = now - lastTransitionTime;
                
                // 记录轮播切换
                const prevIndex = currentImageIndex;
                currentImageIndex = (currentImageIndex + 1) % totalSlides;
                lastTransitionTime = now;
                
                logMessage(`轮播切换: 从第 ${prevIndex + 1} 张到第 ${currentImageIndex + 1} 张 (间隔约 ${Math.round(elapsedSinceLastTransition/1000)} 秒)`);
                currentImage.textContent = `当前显示图片：第 ${currentImageIndex + 1} 张`;
                
                // 检查是否完成了一个完整的循环（从第3张回到第1张）
                if (prevIndex === 2 && currentImageIndex === 0) {
                    cycleCount++;
                    logMessage(`<span class="highlight">✓ 循环完成: 第 ${cycleCount} 次从第3张回到第1张</span>`);
                    
                    // 如果已经完成一次循环，测试成功
                    if (cycleCount === 1) {
                        clearInterval(carouselInterval);
                        clearInterval(timeInterval);
                        markTestComplete(true, '轮播图成功按照要求工作：保留3张图片，每5秒轮播一次，第三张图片5秒后正确回到第一张图片！');
                    }
                }
                
                // 设置超时保护
                if ((now - testStartTime) > 60000) { // 60秒后超时
                    clearInterval(carouselInterval);
                    clearInterval(timeInterval);
                    markTestComplete(false, '测试超时，可能轮播逻辑有问题');
                }
            }, intervalTime);
        }
        
        // 页面加载后执行测试
        window.addEventListener('load', function() {
            displayCarouselCode();
            setTimeout(() => {
                testCarouselCycle();
            }, 1000);
        });
    </script>
</body>
</html>